# Docker Compose Configuration for Media Server Stack
#
# This stack includes:
#   - SABnzbd: Usenet downloader (port 8080)
#   - Sonarr: TV show management (port 8989)
#   - Radarr: Movie management (port 7878)
#   - Jellyfin: Media server (port 8096)
#   - Jellyseerr: Media request management (port 5055)
#
# All services are connected via the 'streaming-network' bridge network
# and run with PUID/PGID 1000 for consistent file permissions

services:

  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:latest
    container_name: sabnzbd
    ports:
      - "8080:8080"
    volumes:
      - /mnt/scratch/downloads:/downloads
      - /media-pool/config/sabnzbd:/config
    restart: unless-stopped
    networks:
      - streaming-network
    environment:
      - PUID=1000
      - PGID=1000

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    ports:
      - "8989:8989"
    volumes:
      - /media-pool/tv:/tv
      - /media-pool/config/sonarr:/config
      - /mnt/scratch/downloads/:/downloads
    restart: unless-stopped
    networks:
      - streaming-network
    environment:
      - PUID=1000
      - PGID=1000

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    ports:
      - "7878:7878"
    volumes:
      - /media-pool/movies:/movies
      - /media-pool/config/radarr:/config
      - /mnt/scratch/downloads/:/downloads
    restart: unless-stopped
    networks:
      - streaming-network
    environment:
      - PUID=1000
      - PGID=1000

  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    ports:
      - "8096:8096"
    devices:
      - /dev/dri:/dev/dri
    group_add:
      - "993"
    environment:
      - PUID=1000
      - PGID=1000
      - DOCKER_MODS=linuxserver/mods:jellyfin-opencl-intel
      - NEOReadDebugKeys=1
      - OverrideGpuAddressSpace=48
      - JELLYFIN_CACHE_DIR=/config/cache
      - JELLYFIN_DATA_DIR=/config/data
      - JELLYFIN_LOG_DIR=/config/log
      - JELLYFIN_TRANSCODE_DIR=/tmp/jellyfin-transcode
    volumes:
      - /media-pool/config/jellyfin:/config
      - ./jellyfin/cache:/cache
      - /media-pool/movies:/movies
      - /media-pool/tv:/tv
      - /mnt/scratch/jellyfin-transcode:/tmp/jellyfin-transcode
    restart: unless-stopped
    networks:
      - streaming-network

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    ports:
      - "5055:5055"
    environment:
      - LOG_LEVEL=info
      - PUID=1000
      - PGID=1000
    volumes:
      - /media-pool/config/jellyseerr:/app/config
    restart: unless-stopped
    networks:
      - streaming-network

networks:
  streaming-network:
    driver: bridge
